<div class="app-container">
  <!-- Toggle View Buttons -->
  <div class="view-toggle">
    <button mat-raised-button [color]="!showUserDashboard ? 'primary' : ''" (click)="showUserDashboard = false" class="toggle-btn">
      <mat-icon>dashboard</mat-icon>
      Administrador
    </button>
    <button mat-raised-button [color]="showUserDashboard ? 'primary' : ''" (click)="showUserDashboard = true" class="toggle-btn">
      <mat-icon>person</mat-icon>
      Trabajador
    </button>
  </div>

  <!-- Admin View (Kanban) -->
  <div *ngIf="!showUserDashboard" class="page-wrapper">
    <div class="form-container">
      <h2>Administrador ✍</h2>
      
      <form class="task-form" [formGroup]="taskForm" (ngSubmit)="addTask()">
            <mat-form-field appearance="outline">
                <mat-label>Título de la tarea</mat-label>
                <input matInput formControlName="title" placeholder="Ej: Implementar Login">
                <mat-error *ngIf="taskForm.get('title')?.hasError('required')">Título requerido</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Área de Trabajo</mat-label>
                <mat-select formControlName="area">
                    <mat-option *ngFor="let area of availableAreas" [value]="area">
                        {{ area }}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="taskForm.get('area')?.hasError('required')">Área requerida</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Prioridad</mat-label>
                <mat-select formControlName="priority">
                    <mat-option *ngFor="let priority of availablePriorities" [value]="priority">
                        {{ priority }}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="taskForm.get('priority')?.hasError('required')">Prioridad requerida</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Fecha de Entrega</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="dueDate" [min]="minDate">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <mat-error *ngIf="taskForm.get('dueDate')?.hasError('required')">Fecha requerida</mat-error>
            </mat-form-field>
            
            <mat-form-field appearance="outline">
                <mat-label>Pago Estimado (S/.)</mat-label>
                <input matInput type="number" formControlName="estimatedPay" min="0">
                <mat-error *ngIf="taskForm.get('estimatedPay')?.hasError('required')">Pago requerido</mat-error>
                <mat-error *ngIf="taskForm.get('estimatedPay')?.hasError('min')">Debe ser 0 o más</mat-error>
            </mat-form-field>
        
        <button mat-flat-button color="primary" type="submit" [disabled]="!taskForm.valid">
          Agregar
        </button>
      </form>
    </div>
    <div class="board-container" cdkDropListGroup>
      <div class="column"
           cdkDropList
           #todoList="cdkDropList"
           [cdkDropListData]="ingenieria"
           [cdkDropListConnectedTo]="[inProgressList, doneList]"
           (cdkDropListDropped)="onDrop($event)">
        
        <h2>Ingeniería - {{ingenieria.length}}</h2>
        <mat-card *ngFor="let task of ingenieria" class="task-card" cdkDrag>
          <span>{{ task.title }}</span>
          <button mat-icon-button class="delete-button" (click)="deleteTask(task, 'ingenieria')">
            <mat-icon>delete_outline</mat-icon>
          </button>
        </mat-card>
      </div>

      <div class="column"
           cdkDropList
           #inProgressList="cdkDropList"
           [cdkDropListData]="logistica"
           [cdkDropListConnectedTo]="[todoList, doneList]"
           (cdkDropListDropped)="onDrop($event)">

        <h2>Logística - {{logistica.length}}</h2>
        <mat-card *ngFor="let task of logistica" class="task-card" cdkDrag>
          <span>{{ task.title }}</span>
          <button mat-icon-button class="delete-button" (click)="deleteTask(task, 'logistica')">
            <mat-icon>delete_outline</mat-icon>
          </button>
        </mat-card>
      </div>

      <div class="column"
           cdkDropList
           #doneList="cdkDropList"
           [cdkDropListData]="marketing"
           [cdkDropListConnectedTo]="[todoList, inProgressList]"
           (cdkDropListDropped)="onDrop($event)">

        <h2>Marketing - {{marketing.length}}</h2>
        <mat-card *ngFor="let task of marketing" class="task-card" cdkDrag>
          <span>{{ task.title }}</span>
          <button mat-icon-button class="delete-button" (click)="deleteTask(task, 'marketing')">
            <mat-icon>delete_outline</mat-icon>
          </button>
        </mat-card>
      </div>
    </div>
  </div>

  <!-- User Dashboard View -->
  <div *ngIf="showUserDashboard" class="user-view-wrapper">
    <app-user-dashboard 
      [userName]="'Juan García'"
      [userArea]="'Ingeniería'"
      [tasks]="userTasks"
      (taskStatusChanged)="onUserTaskStatusChanged($event)"
      (taskDetailsRequested)="onViewTaskDetails($event)">
    </app-user-dashboard>
  </div>
</div>

<router-outlet></router-outlet>
